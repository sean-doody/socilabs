<!DOCTYPE html>
<html lang="en-us">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='Learn how to build custom Twitter datasets using Python, Tweepy, and the Twitter API.'><title>Use Tweepy &amp; Python to Scrape the Twitter API</title>

<link rel='canonical' href='https://sean-doody.github.io/socilabs/p/tweepy-twitter-tutorial/'>

<link rel="stylesheet" href="/socilabs/scss/style.min.css"><meta property='og:title' content='Use Tweepy &amp; Python to Scrape the Twitter API'>
<meta property='og:description' content='Learn how to build custom Twitter datasets using Python, Tweepy, and the Twitter API.'>
<meta property='og:url' content='https://sean-doody.github.io/socilabs/p/tweepy-twitter-tutorial/'>
<meta property='og:site_name' content='SociLabs'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='python' /><meta property='article:tag' content='advanced' /><meta property='article:published_time' content='2021-10-20T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2021-10-20T00:00:00&#43;00:00'/><meta property='og:image' content='https://sean-doody.github.io/socilabs/p/tweepy-twitter-tutorial/twitter.jpg' />
<meta name="twitter:title" content="Use Tweepy &amp; Python to Scrape the Twitter API">
<meta name="twitter:description" content="Learn how to build custom Twitter datasets using Python, Tweepy, and the Twitter API."><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://sean-doody.github.io/socilabs/p/tweepy-twitter-tutorial/twitter.jpg' />
    </head>
    <body class="
    article-page has-toc
">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            localStorage.setItem(colorSchemeKey, "light");
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex 
    
        extended
    
">
    
        <div id="article-toolbar">
            <a href="https://sean-doody.github.io/socilabs/" class="back-home">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="15 6 9 12 15 18" />
</svg>



                <span>Back</span>
            </a>
        </div>
    
<main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/socilabs/p/tweepy-twitter-tutorial/">
                <img src="/socilabs/p/tweepy-twitter-tutorial/twitter_hu96b8e6f01a60d9e713e886147ce39f04_119441_800x0_resize_q75_box.jpg"
                        srcset="/socilabs/p/tweepy-twitter-tutorial/twitter_hu96b8e6f01a60d9e713e886147ce39f04_119441_800x0_resize_q75_box.jpg 800w, /socilabs/p/tweepy-twitter-tutorial/twitter_hu96b8e6f01a60d9e713e886147ce39f04_119441_1600x0_resize_q75_box.jpg 1600w"
                        width="800" 
                        height="600" 
                        loading="lazy"
                        alt="Featured image of post Use Tweepy &amp; Python to Scrape the Twitter API" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/socilabs/categories/python/" style="background-color: #2a9d8f; color: #fff;">
                Python
            </a>
        
            <a href="/socilabs/categories/twitter/" >
                twitter
            </a>
        
            <a href="/socilabs/categories/apis/" >
                apis
            </a>
        
            <a href="/socilabs/categories/advanced/" >
                advanced
            </a>
        
    </header>
    

    <h2 class="article-title">
        <a href="/socilabs/p/tweepy-twitter-tutorial/">Use Tweepy &amp; Python to Scrape the Twitter API</a>
    </h2>

    
    <h3 class="article-subtitle">
        Learn how to build custom Twitter datasets using Python, Tweepy, and the Twitter API.
    </h3>
    

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Oct 20, 2021</time>
            </div>
        

        
    </footer>
    
</div>
</header>

    <section class="article-content">
    <h2 id="introduction">Introduction</h2>
<p>This advanced tutorial will go over how to create custom Twitter datasets by collecting data from the official Twitter API. It assumes you have already <a class="link" href="https://sean-doody.github.io/socilabs/p/install-python/"  target="_blank" rel="noopener"
    >installed Python and Anaconda</a> and are comfortable coding in Python.</p>
<p>The coding examples contained in this codelab can be implemented in your favorite text editor and run as a standalone Python program, or integrated into an IDE or notebook environment like Jupyter Lab.</p>
<p><strong>Note:</strong> This tutorial uses the standard search features of the Twitter API. Users with academic credentials have access to Twitter&rsquo;s historical archive. To learn more about Twitter&rsquo;s academic project track, see both <a class="link" href="https://developer.twitter.com/en/docs/projects/overview#product-track"  target="_blank" rel="noopener"
    >Twitter&rsquo;s official documentation</a> and <a class="link" href="https://docs.tweepy.org/en/stable/client.html?highlight=academichttps://docs.tweepy.org/en/stable/client.html?highlight=academic"  target="_blank" rel="noopener"
    >Tweepy&rsquo;s official documentation</a>.</p>
<h3 id="prerequisites">Prerequisites</h3>
<ul>
<li>Twitter Developer Account</li>
<li>Twitter API Keys</li>
<li>Python coding knowledge</li>
<li>Familiarity with coding loops, dictionary objects, and indexing</li>
<li>Familiarity with functions</li>
</ul>
<p>This tutorial will use the following packages and versions:</p>
<ul>
<li>Python 3.9</li>
<li>Tweepy 4.1.0</li>
<li>Pandas 1.3.4</li>
<li>Twitter API v1.1</li>
</ul>
<h2 id="setting-up-the-environment">Setting up the Environment</h2>
<p>First, let&rsquo;s create a fresh conda environment to install our packages and dependencies. Open up your terminal
and execute the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ &gt; conda create -n twitter-api <span class="nv">python</span><span class="o">=</span>3.9
</code></pre></div><p>Follow the prompt and type <code>y</code> to proceed. Now, activate the environment by executing the following
script:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ &gt; conda activate twitter-api
</code></pre></div><p>Your bash shell or terminal should look something like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="o">(</span>twitter-api<span class="o">)</span> $ &gt;
</code></pre></div><p>The environment name, in paretheses, indicates that we have successfully activated our environment.
Now we can begin installing our dependencies.</p>
<h3 id="install-packages">Install Packages</h3>
<p>First, ensure pip is updated:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="o">(</span>twitter-api<span class="o">)</span> $ &gt; pip install --upgrade pip
</code></pre></div><p>For this tutorial, we will need to install:</p>
<ol>
<li>Tweepy</li>
<li>Pandas</li>
<li>NumPy</li>
</ol>
<p>We can do this easily in one line:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="o">(</span>twitter-api<span class="o">)</span> $ &gt; pip install --upgrade tweepy pandas numpy
</code></pre></div><h2 id="setting-up-tweepy-with-your-credentials">Setting Up Tweepy With Your Credentials</h2>
<p>First, let&rsquo;s make sure we import our libraries:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">tweepy</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</code></pre></div><p>In order to access the Twitter API, you <strong>must</strong> provide the API key, the API secret, and the bearer token provided by Twitter at the time you set up your app in the Twitter Developer dashboard. You will also need to generate an <strong>access token</strong> from within the Twitter Developer dashboard after you have created your app. You will need both your <strong>access token</strong> and <strong>access token secret</strong> to access the API.</p>
<p>It is <strong>never</strong> a good idea to hardcode your credentials into your program. Instead, save them in a separate markup file, such as a JSON file, from which they can be read into your script without having to visibly hardcode them.</p>
<p>You can create a document called <code>keys.json</code> that contains the following contents:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&#34;api_key&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;copy-and-paste-your-api-key-here&gt;&#34;</span><span class="p">,</span>
    <span class="nt">&#34;api_secret&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;copy-and-paste-your-api-secret-key-here&gt;&#34;</span><span class="p">,</span>
    <span class="nt">&#34;bearer_token&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;copy-and-paste-your-bearer-token-here&gt;&#34;</span><span class="p">,</span>
    <span class="nt">&#34;access_token&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;copy-and-pate-your-access-token-here&gt;&#34;</span><span class="p">,</span>
    <span class="nt">&#34;access_secret&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;copy-and-paste-your-access-secret-token-here&gt;&#34;</span>
<span class="p">}</span>
</code></pre></div><p>Then, we can load our credentials into our Python script using the following code:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">json</span>

<span class="c1"># Set the path to your credentials JSON file:</span>
<span class="n">credentials</span> <span class="o">=</span> <span class="s2">&#34;&lt;path_to_your_credential_file&gt;.json&#34;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span> <span class="s2">&#34;r&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">keys</span><span class="p">:</span>
    <span class="n">api_tokens</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>

</code></pre></div><p>Now, instead of hardcoding the keys into our Python app, we can pull them from the JSON file we just loaded. JSON files are treated as <a class="link" href="https://realpython.com/python-dicts/"  target="_blank" rel="noopener"
    >dictionaries</a> when loaded into  Python, meaning we can index them by their keys to extract data.</p>
<p>To see a list of the keys contained in a dictionary, we can use the <code>.keys()</code> method this way: <code>api_tokens.keys()</code>. The keys will match exactly the keys from the JSON credentials file.</p>
<p>Let&rsquo;s grab our credentials from the dictionary using key indexing:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Grab the API keys:</span>
<span class="n">API_KEY</span> <span class="o">=</span> <span class="n">api_tokens</span><span class="p">[</span><span class="s2">&#34;api_key&#34;</span><span class="p">]</span>
<span class="n">API_SECRET</span> <span class="o">=</span> <span class="n">api_tokens</span><span class="p">[</span><span class="s2">&#34;api_secret&#34;</span><span class="p">]</span>
<span class="n">BEARER_TOKEN</span> <span class="o">=</span> <span class="n">api_tokens</span><span class="p">[</span><span class="s2">&#34;bearer_token&#34;</span><span class="p">]</span>
<span class="n">ACCESS_TOKEN</span> <span class="o">=</span> <span class="n">api_tokens</span><span class="p">[</span><span class="s2">&#34;access_token&#34;</span><span class="p">]</span>
<span class="n">ACCESS_SECRET</span> <span class="o">=</span> <span class="n">api_tokens</span><span class="p">[</span><span class="s2">&#34;access_secret&#34;</span><span class="p">]</span>
</code></pre></div><h3 id="connect-to-the-twitter-api">Connect to the Twitter API</h3>
<p>We can now connect to the Twitter API using our credentials. We do this by authenticating our app via Tweepy with our keys:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="c1"># We use Tweepy&#39;s OAuthHandler method to authenticate our credentials:</span>
<span class="n">auth</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">OAuthHandler</span><span class="p">(</span><span class="n">API_KEY</span><span class="p">,</span> <span class="n">API_SECRET</span><span class="p">)</span>

<span class="c1"># Then, we set our access tokens by calling the auth object directly:</span>
<span class="n">auth</span><span class="o">.</span><span class="n">set_access_token</span><span class="p">(</span><span class="n">ACCESS_TOKEN</span><span class="p">,</span> <span class="n">ACCESS_SECRET</span><span class="p">)</span>

<span class="c1"># Finally, we can initialize the Twitter API. </span>
<span class="c1"># NOTE: we will be using this `api` object to interact</span>
<span class="c1"># with Twitter from here on out:</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">API</span><span class="p">(</span><span class="n">auth</span><span class="p">)</span>
</code></pre></div><p>We should now be connected to the Twitter API. To verify that our connection works and our credentials have
been appropriately set up, let&rsquo;s just pull some tweets from your home timeline and print their text:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">test_tweets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">home_timeline</span><span class="p">()</span>

<span class="c1"># Looping through the tweets:</span>
<span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">test_tweets</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">text</span> <span class="o">+</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</code></pre></div><p>Your console should return the text from a sample of tweets pulled from your timeline. <strong>Note:</strong> these will be specific to your followers.</p>
<p>Now that we&rsquo;re all set up, let&rsquo;s get started!</p>
<h2 id="searching-twitter-for-data">Searching Twitter for Data</h2>
<p>There are <em>lots</em> of ways you can search for data on Twitter. You can: follow and pull data from specific accounts; collect tweets grouped by hashtags; find tweets by keyword search; set custom filters; and so on. What sorts of data you need, and the methods you apply to obtain those data, will vary by each research project&rsquo;s use case.</p>
<p>Here, we will focus on using Tweepy&rsquo;s <code>search_tweets</code> method to use keyword queries, which can include hashtags, to search Twitter for tweets.</p>
<h3 id="the-search_tweets-method">The search_tweets Method</h3>
<p>Hashtags and keywords are an excellent way to gather topically relevant Twitter data. In this example, we are going to be searcing for tweets related to COVID-19.</p>
<p>First, let&rsquo;s get a sense for how Tweepy handles Twitter searches and returns results.</p>
<p>Let&rsquo;s pull 10 tweets that match the query <code>#covid19</code>. We do this by calling the <code>search_tweets()</code> method on our API object, setting a search query, and setting a count:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">tweets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">search_tweets</span><span class="p">(</span>
    <span class="n">q</span><span class="o">=</span><span class="s2">&#34;#covid19&#34;</span><span class="p">,</span>
    <span class="n">count</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>
</code></pre></div><p>In this code snipper, <code>q</code> is short for query, which is set equal to <code>#covid19</code> in this example. <code>count</code> tells Tweepy how many tweets to fetch from the Twitter API. Here, we tell Tweepy to only grab 10 tweets.</p>
<p>Importantly, what is returned is not raw tweet text, but a list of Twitter <code>Status</code> objects. We can see this by checking the type of the first tweet—<code>type(tweet[0])</code>—which will return <code>tweepy.models.Status</code>. We will need to take a closer look at this object in order to iterate through it and pull out the data of interest.</p>
<h3 id="navigating-json--dictionaries">Navigating JSON &amp; Dictionaries</h3>
<p>Status objects are based on the JSON data containing tweet and user info for each object. They can be searched two ways: (a.) by calling methods on the status object where each method is a key in the JSON data dictionary; or (b.) grabbing the raw JSON itself and iterating over it directly.</p>
<p>For example, if we wanted to get the text of the first tweet, we could call the <code>text</code> method by
writing <code>tweets[0].text</code>. This corresponds to the <code>text</code> key in the Twitter JSON data. We can do this for other important parameters like <code>id</code>, <code>created_at</code> (the date of the tweet), and so on: <em>any</em> parameter returned by Twitter.</p>
<p>We can see every key available by iterating over the JSON dictionary and printing the key (the JSON is accessible by calling the <code>_json</code> method as illustrated below):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">tweets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_json</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</code></pre></div><p>You should see a list like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">created_at
id
id_str
text
truncated
entities
metadata
source
in_reply_to_status_id
in_reply_to_status_id_str
in_reply_to_user_id
in_reply_to_user_id_str
in_reply_to_screen_name
user
geo
coordinates
place
contributors
retweeted_status
is_quote_status
quoted_status_id
quoted_status_id_str
retweet_count
favorite_count
favorited
retweeted
lang
</code></pre></div><p>Great! Now we have a list of all the available data returned by Twitter. <strong>However</strong>, some of these keys return more, <em>nested</em> JSON. For example, the <code>user</code> key returns a nested JSON dictionary containing information about the poster. We must interact with this nested data the same way we interact with the top-level tweet data.</p>
<p>We can get a list of all the keys and the type of data they return with some simple Python code:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">tweets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_json</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="c1"># We can use a functional string to print the key and its type:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> :: type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">tweets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_json</span><span class="p">[</span><span class="n">key</span><span class="p">])</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</code></pre></div><p>You should see this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">created_at :: type &lt;class &#39;str&#39;&gt;
id :: type &lt;class &#39;int&#39;&gt;
id_str :: type &lt;class &#39;str&#39;&gt;
text :: type &lt;class &#39;str&#39;&gt;
truncated :: type &lt;class &#39;bool&#39;&gt;
entities :: type &lt;class &#39;dict&#39;&gt;
metadata :: type &lt;class &#39;dict&#39;&gt;
source :: type &lt;class &#39;str&#39;&gt;
in_reply_to_status_id :: type &lt;class &#39;NoneType&#39;&gt;
in_reply_to_status_id_str :: type &lt;class &#39;NoneType&#39;&gt;
in_reply_to_user_id :: type &lt;class &#39;NoneType&#39;&gt;
in_reply_to_user_id_str :: type &lt;class &#39;NoneType&#39;&gt;
in_reply_to_screen_name :: type &lt;class &#39;NoneType&#39;&gt;
user :: type &lt;class &#39;dict&#39;&gt;
geo :: type &lt;class &#39;NoneType&#39;&gt;
coordinates :: type &lt;class &#39;NoneType&#39;&gt;
place :: type &lt;class &#39;NoneType&#39;&gt;
contributors :: type &lt;class &#39;NoneType&#39;&gt;
retweeted_status :: type &lt;class &#39;dict&#39;&gt;
is_quote_status :: type &lt;class &#39;bool&#39;&gt;
quoted_status_id :: type &lt;class &#39;int&#39;&gt;
quoted_status_id_str :: type &lt;class &#39;str&#39;&gt;
retweet_count :: type &lt;class &#39;int&#39;&gt;
favorite_count :: type &lt;class &#39;int&#39;&gt;
favorited :: type &lt;class &#39;bool&#39;&gt;
retweeted :: type &lt;class &#39;bool&#39;&gt;
lang :: type &lt;class &#39;str&#39;&gt;
</code></pre></div><p>Now, we can see the type of data each key is associated with. <code>str</code> just means stirng, or text; <code>int</code> just means an integer; <code>bool</code> just means a value of either <code>True</code> or <code>False</code>; and <code>NoneType</code> just means the data is empty or not applicable and can safely be ignored.</p>
<p>Importantly, though, notice that some keys contain class <code>dict</code>: this means that they are associated with a dictionary, and contain further nested data. Let&rsquo;s use <code>user</code> as an example.</p>
<p>To see all of the keys in the <code>user</code> data, you can use this code:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">tweets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">_json</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</code></pre></div><p>This returns all <code>user</code>-level keys:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">id
id_str
name
screen_name
location
description
url
entities
protected
followers_count
friends_count
listed_count
created_at
favourites_count
utc_offset
time_zone
geo_enabled
verified
statuses_count
lang
contributors_enabled
is_translator
is_translation_enabled
profile_background_color
profile_background_image_url
profile_background_image_url_https
profile_background_tile
profile_image_url
profile_image_url_https
profile_banner_url
profile_link_color
profile_sidebar_border_color
profile_sidebar_fill_color
profile_text_color
profile_use_background_image
has_extended_profile
default_profile
default_profile_image
following
follow_request_sent
notifications
translator_type
withheld_in_countries
</code></pre></div><p>Again, to see if there is anymore nested data, you can check the data type returned with each key:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">tweets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">_json</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> :: type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">tweets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">_json</span><span class="p">[</span><span class="n">key</span><span class="p">])</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</code></pre></div><p>Which returns:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">id :: type &lt;class &#39;int&#39;&gt;
id_str :: type &lt;class &#39;str&#39;&gt;
name :: type &lt;class &#39;str&#39;&gt;
screen_name :: type &lt;class &#39;str&#39;&gt;
location :: type &lt;class &#39;str&#39;&gt;
description :: type &lt;class &#39;str&#39;&gt;
url :: type &lt;class &#39;NoneType&#39;&gt;
entities :: type &lt;class &#39;dict&#39;&gt;
protected :: type &lt;class &#39;bool&#39;&gt;
followers_count :: type &lt;class &#39;int&#39;&gt;
friends_count :: type &lt;class &#39;int&#39;&gt;
listed_count :: type &lt;class &#39;int&#39;&gt;
created_at :: type &lt;class &#39;str&#39;&gt;
favourites_count :: type &lt;class &#39;int&#39;&gt;
utc_offset :: type &lt;class &#39;NoneType&#39;&gt;
time_zone :: type &lt;class &#39;NoneType&#39;&gt;
geo_enabled :: type &lt;class &#39;bool&#39;&gt;
verified :: type &lt;class &#39;bool&#39;&gt;
statuses_count :: type &lt;class &#39;int&#39;&gt;
lang :: type &lt;class &#39;NoneType&#39;&gt;
contributors_enabled :: type &lt;class &#39;bool&#39;&gt;
is_translator :: type &lt;class &#39;bool&#39;&gt;
is_translation_enabled :: type &lt;class &#39;bool&#39;&gt;
profile_background_color :: type &lt;class &#39;str&#39;&gt;
profile_background_image_url :: type &lt;class &#39;str&#39;&gt;
profile_background_image_url_https :: type &lt;class &#39;str&#39;&gt;
profile_background_tile :: type &lt;class &#39;bool&#39;&gt;
profile_image_url :: type &lt;class &#39;str&#39;&gt;
profile_image_url_https :: type &lt;class &#39;str&#39;&gt;
profile_banner_url :: type &lt;class &#39;str&#39;&gt;
profile_link_color :: type &lt;class &#39;str&#39;&gt;
profile_sidebar_border_color :: type &lt;class &#39;str&#39;&gt;
profile_sidebar_fill_color :: type &lt;class &#39;str&#39;&gt;
profile_text_color :: type &lt;class &#39;str&#39;&gt;
profile_use_background_image :: type &lt;class &#39;bool&#39;&gt;
has_extended_profile :: type &lt;class &#39;bool&#39;&gt;
default_profile :: type &lt;class &#39;bool&#39;&gt;
default_profile_image :: type &lt;class &#39;bool&#39;&gt;
following :: type &lt;class &#39;bool&#39;&gt;
follow_request_sent :: type &lt;class &#39;bool&#39;&gt;
notifications :: type &lt;class &#39;bool&#39;&gt;
translator_type :: type &lt;class &#39;str&#39;&gt;
withheld_in_countries :: type &lt;class &#39;list&#39;&gt;
</code></pre></div><p>It looks like the only further nested data for <code>user</code> is <code>entities</code>. To learn more about <code>entities</code> objects, <a class="link" href="https://developer.twitter.com/en/docs/twitter-api/v1/data-dictionary/object-model/entities"  target="_blank" rel="noopener"
    >check out the official Twitter API documentation</a>.</p>
<p>Familiarizing yourself with these keys and their associated data structure is essential for effectively navigating the Twitter API. Take some time to explore these keys and familiarize yourself with Python dictionary objects if this feels confusing.</p>
<p>Choosing which data you need is specific to your use case and research project. However, some data is <strong>absolutely necessary</strong> to maintain the integrity of your dataset. Four <strong>absolutely essential</strong> data are:</p>
<ol>
<li>The tweet <code>id</code>.</li>
<li>The tweet <code>created_at</code> UTC timestamp.</li>
<li>The tweet <code>text</code>.</li>
<li>The tweet <code>author</code>.</li>
<li>The weet <code>author_id</code>.</li>
</ol>
<p>Almost certainly you will want and need more data, including hashtags, user mentions, whether or not a tweet is a retweet, favorite counts, and so on. Familiarizing yourself with the Twitter API, as well as Twitter itself, is absolutely necessary to determining which data you need.</p>
<h3 id="paginating-twitter-data">Paginating Twitter Data</h3>
<p>In the simple example given above, we searched Twitter for 10 tweets relevant to the query <code>#covid19</code>. When Twitter returns tweets, it does so in batches of JSON. The max size a batch can be is 100, meaning Twitter will only return 100 tweets per batch. In order to return more batches of Tweets, you will need to paginate the Tweets using Tweepy&rsquo;s <code>Cursor()</code> method. Luckily, implementing pagination is extremely easy with Tweepy. Do note that you must be attentive to rate limitations on your API calls, which you can <a class="link" href="https://developer.twitter.com/en/docs/twitter-api/rate-limits"  target="_blank" rel="noopener"
    >read more about in the Twitter API documentation</a>.</p>
<p>When searching and paginating Tweets with Tweepy&rsquo;s <code>Cursor()</code>, we use the following syntax:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">tweets</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">Cursor</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">search_tweets</span><span class="p">,</span>
                       <span class="n">q</span><span class="o">=</span><span class="s2">&#34;#covid19&#34;</span><span class="p">,</span>
                       <span class="n">count</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
</code></pre></div><p>Using the <code>Cursor()</code> method, we instructed Tweepy to fetch 500 (<code>.items(500)</code>) total tweets in batches of 100 (<code>count=100</code>). In other words, we have 5 pages of Tweets. However, the tweets are not returned directly. Instead, Tweepy creates a <a class="link" href="https://wiki.python.org/moin/Generators"  target="_blank" rel="noopener"
    >generator object</a> that we have to iterate through to extract each tweet.</p>
<p>To see how this works, let&rsquo;s grab the text of the first 10 tweets:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Because it&#39;s a generator, we need to have a counter:</span>
<span class="n">n_tweets</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">tweets</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">n_tweets</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">text</span> <span class="o">+</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
        <span class="n">n_tweets</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
</code></pre></div><p>The text of the first 10 tweets contained in the generator will be returned. We can simplify our code a bit by iterating over the generator a bit differently, as shown below:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">Cursor</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">search_tweet</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="s2">&#34;#covid19&#34;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div><p>This simplified syntax prevents us from having to create a seperate variable containing the Tweepy generator. Instead, we just loop through the generator and discard it after we&rsquo;re done. Easy!</p>
<p>Now let&rsquo;s combine these insights to build a full working example that includes aggregating the tweets into a Pandas dataframe and turning the tweets into a functional dataset.</p>
<h2 id="a-working-example">A Working Example</h2>
<p>We&rsquo;re now going to bring these pieces together and add some more specificty (and slightly more coplexity) to our Twitter scrape.</p>
<p>First, let&rsquo;s prepare the parameters for the <code>search_tweets()</code> method in separate variables. This allows us to change the content of the variable without having to manually change the query in our <code>api</code> object any time we want to modify our search terms. We will also tell Tweepy how many tweets we want per page and set the page limit. Importantly, we will introduce the parameter <code>tweet_mode</code> and set it to <code>extended</code> in order to get the full text of a tweet. While Twitter now allows 280 character tweets, by default, the Twitter API truncates tweets to 140 characters. We must override this. Additionally, the <code>text</code> parameter we have been using will now change to <code>full_text</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1"># We can use logical search operators in our query text.</span>
<span class="c1"># Let&#39;s add a series of hashtags with OR, meaning a tweet can</span>
<span class="c1"># contain any of the search terms:</span>
<span class="n">query</span> <span class="o">=</span> <span class="s2">&#34;#covid19 OR #covid OR #covid-19 OR #coronavirus</span>

<span class="c1"># We will also add a new parameter that limits us to English</span>
<span class="c1"># results only:</span>
<span class="n">lang</span> <span class="o">=</span> <span class="s2">&#34;en&#34;</span>

<span class="c1"># Ensure extended is set to true:</span>
<span class="n">tweet_mode</span> <span class="o">=</span> <span class="s2">&#34;extended&#34;</span>

<span class="c1"># Let&#39;s limit ourselves to 100 tweets per page:</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">100</span> 

<span class="c1"># Let&#39;s grab only 1000 tweets:</span>
<span class="n">tweet_limit</span> <span class="o">=</span> <span class="mi">1000</span>
</code></pre></div><p>Now, we can use these variables are parameters in our Tweepy API without needing to hardcode them directly.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">Cursor</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">search_comments</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">query</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="n">lang</span><span class="p">,</span> <span class="n">tweet_mode</span><span class="o">=</span><span class="n">tweet_mode</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="n">tweet_limit</span><span class="p">):</span>
    <span class="o">&lt;...</span><span class="n">do</span> <span class="n">something</span><span class="o">...&gt;</span>
</code></pre></div><p>While we have been simply printing the text of tweets, it is time to actually begin extracing the data we want from each tweet. Tweet data, such as a tweet&rsquo;s text and ID, are not nested and can be easily extracted. However, user-level data is nested in a sub-dictionary, and data like hashtags and user-mentions are nested in sub-dictionaries that themselves contain <em>further</em> sub-dictionaries. As mentioned earlier, familiarizing yourself with the JSON structure of the Tweet data and Python&rsquo;s dictionary class is essential. For now, let&rsquo;s see some working examples.</p>
<p>Let&rsquo;s map out the variables of interest At different levels:</p>
<ul>
<li>
<p>Tweet level:</p>
<ul>
<li><code>id</code></li>
<li><code>created_at</code></li>
<li><code>full_text</code></li>
<li><code>hashtags</code></li>
<li><code>user_mentions</code></li>
<li><code>in_reply_to_user_id</code></li>
<li><code>in_reply_to_screen_name</code></li>
<li><code>is_quote_status</code></li>
<li>Whether or not the tweet is a retweet (and if so, that tweet&rsquo;s identifiers).</li>
<li><code>retweet_count</code></li>
<li><code>favorite_count</code></li>
</ul>
</li>
<li>
<p>User level:</p>
<ul>
<li>The user&rsquo;s <code>id</code></li>
<li>The user&rsquo;s <code>screen_name</code></li>
<li>The user&rsquo;s <code>name</code></li>
<li><code>verified</code> status</li>
</ul>
</li>
</ul>
<p>Let&rsquo;s see how to access this data by refactoring our code and wrapping everything together into a nice function that takes arguments for the API parameters, iterates through the tweets, and returns a nicely formatted Pandas dataframe.</p>
<h3 id="refactoring-into-a-function">Refactoring Into a Function</h3>
<p>If you are not familiar with Python functions, consider <a class="link" href="https://www.learnpython.org/en/Functions"  target="_blank" rel="noopener"
    >taking some time to learn more about them</a>. You are also free to follow along. Otherwise, let&rsquo;s get started!</p>
<p>Let&rsquo;s define a Tweet scraping function that takes all of our API parameters of interest as arguments:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">tweet_scraper</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="s2">&#34;en&#34;</span><span class="p">,</span> <span class="n">tweet_mode</span><span class="o">=</span><span class="s2">&#34;extended&#34;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">tweet_limit</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
    <span class="s2">&#34;&#34;&#34;
</span><span class="s2">    This function takes Tweepy search_tweets parameters as arguments and returns a Pandas
</span><span class="s2">    dataframe containing tweet data.
</span><span class="s2">
</span><span class="s2">    :param query: a keyword search phrase (string)
</span><span class="s2">    :param lang: limit results by language (default: English)
</span><span class="s2">    :param tweet_mode: choose whether to extend tweets to full 280 characters.
</span><span class="s2">    :param count: the number of tweets to return per page (default: 100; max: 100)
</span><span class="s2">    :param tweet_limit: the maximum number of tweets to return (default: 1000).
</span><span class="s2">    &#34;&#34;&#34;</span>

    <span class="c1"># First, let&#39;s create a dictionary that will store our tweet data. We</span>
    <span class="c1"># are using a dictionary because we can easily generate a Pandas dataframe</span>
    <span class="c1"># from the dictionary keys.</span>
    <span class="c1">#</span>
    <span class="c1"># The dictionary will be formatted so that its keys are parameters associated with</span>
    <span class="c1"># each tweet and its values are lists to which we will append results for each tweet:</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&#34;user_id&#34;</span><span class="p">:</span> <span class="p">[],</span> 
        <span class="s2">&#34;screen_name&#34;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&#34;verified&#34;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&#34;created_at&#34;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&#34;full_text&#34;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&#34;retweet_count&#34;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&#34;favorite_count&#34;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&#34;hashtags&#34;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&#34;user_mentions&#34;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&#34;in_reply_to_user_id&#34;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&#34;in_reply_to_screen_name&#34;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&#34;is_quote_status&#34;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&#34;is_retweet&#34;</span><span class="p">:</span> <span class="p">[],</span> <span class="c1"># we will have to build this parameter ourselves; see below</span>
        <span class="s2">&#34;retweet_og_id&#34;</span><span class="p">:</span> <span class="p">[],</span> <span class="c1"># the ID of the original retweeted tweet</span>
        <span class="s2">&#34;retweet_og_author_id&#34;</span><span class="p">:</span> <span class="p">[],</span> <span class="c1"># the original author ID of a retweeted tweet</span>
        <span class="s2">&#34;retweet_og_author_screen_name&#34;</span><span class="p">:</span> <span class="p">[],</span> <span class="c1"># the original author screen name of a retweeted tweet</span>
        <span class="s2">&#34;retweet_og_author_name&#34;</span><span class="p">:</span> <span class="p">[],</span> <span class="c1"># the original author&#39;s name of a retweeted tweet</span>
        <span class="s2">&#34;retweet_og_date&#34;</span><span class="p">:</span> <span class="p">[],</span> <span class="c1"># the date of the original tweet</span>
        <span class="s2">&#34;retweet_og_full_text&#34;</span><span class="p">:</span> <span class="p">[],</span> <span class="c1"># OG full text of the retweet</span>
        <span class="s2">&#34;retweet_og_retweet_count&#34;</span><span class="p">:</span> <span class="p">[],</span> <span class="c1"># OG retweet count</span>
        <span class="s2">&#34;retweet_og_favorite_count&#34;</span><span class="p">:</span> <span class="p">[]</span> <span class="c1"># OG favorite count</span>
    <span class="p">}</span>

    <span class="c1"># Search the tweets as we&#39;ve already done, but this time, plug in the paremeter values</span>
    <span class="c1"># from the function arguments:</span>

    <span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">Cursor</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">search_tweets</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">query</span><span class="p">,</span> <span class="n">tweet_mode</span><span class="o">=</span><span class="n">tweet_mode</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="n">tweet_limit</span><span class="p">):</span>
        <span class="s2">&#34;&#34;&#34;
</span><span class="s2">        We need to start with user level variables, meaning we are going to iterate
</span><span class="s2">        through the user dictionary. We can do this easily! Then, we are going to
</span><span class="s2">        append the data to the list in our data dictionary. Let&#39;s see how it&#39;s
</span><span class="s2">        done:
</span><span class="s2">        &#34;&#34;&#34;</span>

        <span class="c1"># User ID:</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&#34;user_id&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="c1"># Screen name:</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&#34;screen_name&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">screen_name</span><span class="p">)</span>
        <span class="c1"># Name:</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&#34;name&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="c1"># verified status:</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&#34;verified&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">verified</span><span class="p">)</span>

        <span class="s2">&#34;&#34;&#34;
</span><span class="s2">        Great! Now let&#39;s grab the tweet level data:
</span><span class="s2">        &#34;&#34;&#34;</span>

        <span class="c1"># Tweet ID:</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&#34;id&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="c1"># Date:</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&#34;created_at&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">created_at</span><span class="p">)</span>
        <span class="c1"># Full text of tweet:</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&#34;full_text&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">full_text</span><span class="p">)</span>
        <span class="c1"># Get retweet count:</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_count&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">retweet_count</span><span class="p">)</span>
        <span class="c1"># Get favorite count:</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&#34;favorite_count&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">favorite_count</span><span class="p">)</span>
        
        <span class="c1"># NOTE: to get hashtags &amp; user mentions, we need to iterate through</span>
        <span class="c1"># the entities sub dictionary. Then, we need to iterate through</span>
        <span class="c1"># the hashtag sub dictionary. It sounds bad, but it&#39;s not! </span>
        <span class="c1"># We will save the hashtags to a list and append the list</span>
        <span class="c1"># to our data dictionary:</span>

        <span class="n">hashtags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Try to get hashtags; if there is an error, then there are no hashtags</span>
        <span class="c1"># and we can pass:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">hashtag</span> <span class="ow">in</span> <span class="n">tweet</span><span class="o">.</span><span class="n">entities</span><span class="p">[</span><span class="s2">&#34;hashtags&#34;</span><span class="p">]:</span>
                <span class="n">hashtags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hashtag</span><span class="p">[</span><span class="s2">&#34;text&#34;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        
        <span class="c1"># Now append the hashtag list to our dataset! If there are no</span>
        <span class="c1"># hashtags, just set it equal to NaN:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hashtags</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;hashtags&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;hashtags&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hashtags</span><span class="p">)</span>

        <span class="c1"># We do the same thing for user mentions:</span>
        <span class="n">mentions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">mention</span> <span class="ow">in</span> <span class="n">tweet</span><span class="o">.</span><span class="n">entities</span><span class="p">[</span><span class="s2">&#34;user_mentions&#34;</span><span class="p">]:</span>
                <span class="n">mentions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mention</span><span class="p">[</span><span class="s2">&#34;screen_name&#34;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mentions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;user_mentions&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;user_mentions&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mentions</span><span class="p">)</span>

        <span class="c1"># In reply to user id:</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&#34;in_reply_to_user_id&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">in_reply_to_user_id</span><span class="p">)</span>
        <span class="c1"># In reply to user screen name:</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&#34;in_reply_to_screen_name&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">in_reply_to_screen_name</span><span class="p">)</span>
        <span class="c1"># Check if quote status:</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&#34;is_quote_status&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">is_quote_status</span><span class="p">)</span>

        <span class="c1"># We need to check if a tweet is a retweet ourselves. We can do this by checking</span>
        <span class="c1"># if the retweeted_status key is present in the JSON:</span>
        <span class="k">if</span> <span class="s2">&#34;retweeted_status&#34;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="o">.</span><span class="n">_json</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># Then it is a retweet:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;is_retweet&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># Get OG tweet id:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_og_id&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">retweeted_status</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="c1"># Get OG author ID:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_og_author_id&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">retweeted_status</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="c1"># Get OG author screen name:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_og_author_screen_name&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">retweeted_status</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">screen_name</span><span class="p">)</span>
            <span class="c1"># Get OG author name:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_og_author_name&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">retweeted_status</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="c1"># Get date of OG tweet:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_og_date&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">retweeted_status</span><span class="o">.</span><span class="n">created_at</span><span class="p">)</span>
            <span class="c1"># Get OG full text:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_og_full_text&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">retweeted_status</span><span class="o">.</span><span class="n">full_text</span><span class="p">)</span>
            <span class="c1"># Get OG retweet count:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_og_retweet_count&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">retweeted_status</span><span class="o">.</span><span class="n">retweet_count</span><span class="p">)</span>
            <span class="c1"># Get OG favorite count:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_og_favorite_count&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">retweeted_status</span><span class="o">.</span><span class="n">favorite_count</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Set is_retweet to false and all other values to np.nan:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;is_retweet&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_og_id&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_og_author_id&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_og_author_screen_name&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_og_author_name&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_og_date&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_og_full_text&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_og_retweet_count&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_og_favorite_count&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    
    <span class="c1"># Whoo! That&#39;s a lot of code. Now, let&#39;s turn our data dictionary into a Pandas dataframe</span>
    <span class="c1"># and then return it:</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># Now send it out:</span>
    <span class="k">return</span> <span class="n">df</span>

</code></pre></div><p>We made it! Let&rsquo;s call the function and save our data. We can preset our function arguments as separate variables, which will allow us to override default function values if we like, and then pass them into the function itself:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="c1"># Set the function parameters:</span>
<span class="n">query</span> <span class="o">=</span> <span class="s2">&#34;#covid19 OR #covid OR #covid-19 OR #coronavirus</span>
<span class="n">lang</span> <span class="o">=</span> <span class="s2">&#34;en&#34;</span>
<span class="n">tweet_mode</span> <span class="o">=</span> <span class="s2">&#34;extended&#34;</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">100</span> 
<span class="n">tweet_limit</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="c1"># Call the function using our parameters:</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">tweet_scraper</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="n">lang</span><span class="p">,</span> <span class="n">tweet_mode</span><span class="o">=</span><span class="n">tweet_mode</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">,</span> <span class="n">tweet_limit</span><span class="o">=</span><span class="n">tweet_limit</span><span class="p">)</span>
</code></pre></div><p>Awesome! We now have our Tweet data in a structured, tabular, dataframe. Let&rsquo;s inspect our data by calling Pandas&rsquo;s <code>head()</code> method. This method allows you to the see the top <code>N</code> samples in your dataframe. By default, this is set to 5, but we can override ths by passing an argument into the parentheses. Let&rsquo;s look at the top 10 posts:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div><p>You should see a result like this:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">user_id</th>
<th style="text-align:left">screen_name</th>
<th style="text-align:left">name</th>
<th style="text-align:left">verified</th>
<th style="text-align:right">id</th>
<th>&hellip;</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">45823110</td>
<td style="text-align:left">jude5456</td>
<td style="text-align:left">Jude 🇪🇺 💙🌹</td>
<td style="text-align:left">False</td>
<td style="text-align:right">1450854059968184336</td>
<td>&hellip;</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">4904619394</td>
<td style="text-align:left">Suzyistdaheim</td>
<td style="text-align:left">𝕊𝕦𝕫𝕪™ 😷💉💉🏠🍀</td>
<td style="text-align:left">False</td>
<td style="text-align:right">1450854059963977731</td>
<td>&hellip;</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">138468171</td>
<td style="text-align:left">captainpt</td>
<td style="text-align:left">Peter Schultz</td>
<td style="text-align:left">False</td>
<td style="text-align:right">1450854058856751106</td>
<td>&hellip;</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">2253036106</td>
<td style="text-align:left">CRCrangelc</td>
<td style="text-align:left">Clodovaldo Rangel</td>
<td style="text-align:left">False</td>
<td style="text-align:right">1450854058407956480</td>
<td>&hellip;</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">3082370998</td>
<td style="text-align:left">BeckyRae12345</td>
<td style="text-align:left">Becca</td>
<td style="text-align:left">False</td>
<td style="text-align:right">1450854058009534464</td>
<td>&hellip;</td>
</tr>
<tr>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:left">&hellip;</td>
<td style="text-align:left">&hellip;</td>
<td style="text-align:left">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td>&hellip;</td>
</tr>
</tbody>
</table>
<p>I have truncated the columns and rows. In total, we have 23 columns of data. You can see this for yourself simply by printing the length of the <code>.columns</code> attribute of the Pandas dataframe:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2"> columns&#34;</span><span class="p">)</span>
</code></pre></div><p>Which returns:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">There are 23 columns
</code></pre></div><p>You can also see all the columns in the dataframe by printing them:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
</code></pre></div><p>Which should produce:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">user_id
screen_name
name
verified
id
created_at
full_text
retweet_count
favorite_count
hashtags
user_mentions
in_reply_to_user_id
in_reply_to_screen_name
is_quote_status
is_retweet
retweet_og_id
retweet_og_author_id
retweet_og_author_screen_name
retweet_og_author_name
retweet_og_date
retweet_og_full_text
retweet_og_retweet_count
retweet_og_favorite_count
</code></pre></div><p>Excellent! Now, we can move on to saving our data.</p>
<h2 id="saving-the-data">Saving the Data</h2>
<p>Pandas makes saving dataframes as local files extremely easy. I strongly advise that we save our dataframe in JSON format because our dataframe contains columns populated by lists. Specifically, the <code>hashtags</code> and <code>user_mentions</code> columns both contain lists of hashtags and mentioned users, respectively. JSON natively supports lists. If we save the dataframe as a CSV file, these lists will be converted to plaintext strings. We <strong>do not</strong> want this.</p>
<p>There is a workaround, however: we can turn the lists into strings using Python&rsquo;s <code>join()</code> method, and then re-split the strings into lists again as needed. We illustrate how to do this below.</p>
<h3 id="saving-as-json">Saving as JSON</h3>
<p>To save as JSON without changing the list variabels, simply call the <code>to_json()</code> method:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">df</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s2">&#34;twitter_data.json&#34;</span><span class="p">)</span>
</code></pre></div><p>And we&rsquo;re done! You can name your datafile whatever you like.</p>
<p>When you&rsquo;re ready to load your json file again, we call the <code>read_json()</code> method and save it to a variable:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="s2">&#34;twitter_data.json&#34;</span><span class="p">)</span>
</code></pre></div><p>Voila! The data is back.</p>
<h3 id="saving-to-a-csv">Saving to a CSV</h3>
<p>If you insist on saving your data in CSV format, you need to deal with the lists in the <code>hashtags</code> and <code>user_mentions</code> columns. To do this, we are going to create a function that converts the list to a string, where each list item is separated by a comma (<code>,</code>). In the future, if we want to convert the columns back to a list, we can simply split on the comma.</p>
<p>Let&rsquo;s see how this works:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Let&#39;s create a function that cleans up the lists:</span>
<span class="k">def</span> <span class="nf">list_cleaner</span><span class="p">(</span><span class="n">list_object</span><span class="p">):</span>
    <span class="s2">&#34;&#34;&#34;
</span><span class="s2">    This function takes one argument: list_object, which is list.
</span><span class="s2">    &#34;&#34;&#34;</span>

    <span class="c1"># Let&#39;s try to join the list. Note that we nest the join in a Try/Except</span>
    <span class="c1"># pattern. This is because not all Tweets contain either hashtags or user mentions.</span>
    <span class="c1"># In this case, they simply have a NaN missing value. This will throw an error if </span>
    <span class="c1"># not dealt with:</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s2">&#34;,&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">list_object</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">list_object</span>
    
    <span class="k">return</span> <span class="n">output</span>
</code></pre></div><p>Now we can use Pandas&rsquo;s <code>apply()</code> method to map the function to the columns and fix the lists. We do this by calling <code>apply()</code> on the column of interest and passing our function, <em>wihout parentheses</em>, as an argument:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Fix hashtags list:</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&#34;hashtags&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;hashtags&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">list_cleaner</span><span class="p">)</span>

<span class="c1"># Fix mentions list:</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&#34;user_mentions&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;user_mentions&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">list_cleaner</span><span class="p">)</span>
</code></pre></div><p>Awesome! Our lists are now strings and can safely be saved as CSV. This is a simple one-liner:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&#34;twitter_data.csv&#34;</span><span class="p">)</span>
</code></pre></div><p>And if we wanted to load the CSV file when we&rsquo;re ready:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&#34;twitter_data.csv&#34;</span><span class="p">)</span>
</code></pre></div><p>To re-split the data back into a list after re-loading the CSV, we can write on more simple helper function:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">split_into_list</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="c1"># We need exception handling again for missing values:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Remember: we joined on a comma, so let&#39;s split on a comma:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;,&#34;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">text</span>
    
    <span class="k">return</span> <span class="n">output</span>
</code></pre></div><p>And then apply it to our columns again:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Split hashtags back into a list:</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&#34;hashtags&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;hashtags&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">split_into_list</span><span class="p">)</span>

<span class="c1"># Split mentions back into list:</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&#34;user_mentions&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;user_mentions&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">split_into_list</span><span class="p">)</span>
</code></pre></div><p>Fantastic! Our hashtags and user mentions are back into a list.</p>
<h2 id="putting-it-all-together">Putting it All Together</h2>
<p>Here&rsquo;s what the final, combined, script will look like in a single Python file:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">tweepy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Load credentials:</span>
<span class="n">credentials</span> <span class="o">=</span> <span class="s2">&#34;keys.json&#34;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span> <span class="s2">&#34;r&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">keys</span><span class="p">:</span>
    <span class="n">api_tokens</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>

<span class="c1"># Grab the API keys:</span>
<span class="n">API_KEY</span> <span class="o">=</span> <span class="n">api_tokens</span><span class="p">[</span><span class="s2">&#34;api_key&#34;</span><span class="p">]</span>
<span class="n">API_SECRET</span> <span class="o">=</span> <span class="n">api_tokens</span><span class="p">[</span><span class="s2">&#34;api_secret&#34;</span><span class="p">]</span>
<span class="n">BEARER_TOKEN</span> <span class="o">=</span> <span class="n">api_tokens</span><span class="p">[</span><span class="s2">&#34;bearer_token&#34;</span><span class="p">]</span>
<span class="n">ACCESS_TOKEN</span> <span class="o">=</span> <span class="n">api_tokens</span><span class="p">[</span><span class="s2">&#34;access_token&#34;</span><span class="p">]</span>
<span class="n">ACCESS_SECRET</span> <span class="o">=</span> <span class="n">api_tokens</span><span class="p">[</span><span class="s2">&#34;access_secret&#34;</span><span class="p">]</span>

<span class="c1"># Connect to the Twitter API:</span>
<span class="n">auth</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">OAuthHandler</span><span class="p">(</span><span class="n">API_KEY</span><span class="p">,</span> <span class="n">API_SECRET</span><span class="p">)</span>
<span class="n">auth</span><span class="o">.</span><span class="n">set_access_token</span><span class="p">(</span><span class="n">ACCESS_TOKEN</span><span class="p">,</span> <span class="n">ACCESS_SECRET</span><span class="p">)</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">API</span><span class="p">(</span><span class="n">auth</span><span class="p">)</span>

<span class="c1"># Set the function parameters:</span>
<span class="n">query</span> <span class="o">=</span> <span class="s2">&#34;#covid19 OR #covid OR #covid-19 OR #coronavirus</span>
<span class="n">lang</span> <span class="o">=</span> <span class="s2">&#34;en&#34;</span>
<span class="n">tweet_mode</span> <span class="o">=</span> <span class="s2">&#34;extended&#34;</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">100</span> 
<span class="n">tweet_limit</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="c1"># Define the scraping function:</span>
<span class="k">def</span> <span class="nf">tweet_scraper</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="s2">&#34;en&#34;</span><span class="p">,</span> <span class="n">tweet_mode</span><span class="o">=</span><span class="s2">&#34;extended&#34;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">tweet_limit</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
    <span class="s2">&#34;&#34;&#34;
</span><span class="s2">    This function takes Tweepy search_tweets parameters as arguments and returns a Pandas
</span><span class="s2">    dataframe containing tweet data.
</span><span class="s2">
</span><span class="s2">    :param query: a keyword search phrase (string)
</span><span class="s2">    :param lang: limit results by language (default: English)
</span><span class="s2">    :param tweet_mode: choose whether to extend tweets to full 280 characters.
</span><span class="s2">    :param count: the number of tweets to return per page (default: 100; max: 100)
</span><span class="s2">    :param tweet_limit: the maximum number of tweets to return (default: 1000).
</span><span class="s2">    &#34;&#34;&#34;</span>

    <span class="c1"># Data dictionary for collecting results:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&#34;user_id&#34;</span><span class="p">:</span> <span class="p">[],</span> 
        <span class="s2">&#34;screen_name&#34;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&#34;verified&#34;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&#34;created_at&#34;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&#34;full_text&#34;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&#34;retweet_count&#34;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&#34;favorite_count&#34;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&#34;hashtags&#34;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&#34;user_mentions&#34;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&#34;in_reply_to_user_id&#34;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&#34;in_reply_to_screen_name&#34;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&#34;is_quote_status&#34;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&#34;is_retweet&#34;</span><span class="p">:</span> <span class="p">[],</span> <span class="c1"># we will have to build this parameter ourselves; see below</span>
        <span class="s2">&#34;retweet_og_id&#34;</span><span class="p">:</span> <span class="p">[],</span> <span class="c1"># the ID of the original retweeted tweet</span>
        <span class="s2">&#34;retweet_og_author_id&#34;</span><span class="p">:</span> <span class="p">[],</span> <span class="c1"># the original author ID of a retweeted tweet</span>
        <span class="s2">&#34;retweet_og_author_screen_name&#34;</span><span class="p">:</span> <span class="p">[],</span> <span class="c1"># the original author screen name of a retweeted tweet</span>
        <span class="s2">&#34;retweet_og_author_name&#34;</span><span class="p">:</span> <span class="p">[],</span> <span class="c1"># the original author&#39;s name of a retweeted tweet</span>
        <span class="s2">&#34;retweet_og_date&#34;</span><span class="p">:</span> <span class="p">[],</span> <span class="c1"># the date of the original tweet</span>
        <span class="s2">&#34;retweet_og_full_text&#34;</span><span class="p">:</span> <span class="p">[],</span> <span class="c1"># OG full text of the retweet</span>
        <span class="s2">&#34;retweet_og_retweet_count&#34;</span><span class="p">:</span> <span class="p">[],</span> <span class="c1"># OG retweet count</span>
        <span class="s2">&#34;retweet_og_favorite_count&#34;</span><span class="p">:</span> <span class="p">[]</span> <span class="c1"># OG favorite count</span>
    <span class="p">}</span>

    <span class="c1"># Search the tweets as we&#39;ve already done, but this time, plug in the paremeter values</span>
    <span class="c1"># from the function arguments:</span>

    <span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">Cursor</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">search_tweets</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">query</span><span class="p">,</span> <span class="n">tweet_mode</span><span class="o">=</span><span class="n">tweet_mode</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="n">tweet_limit</span><span class="p">):</span>
        <span class="c1"># User ID:</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&#34;user_id&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="c1"># Screen name:</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&#34;screen_name&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">screen_name</span><span class="p">)</span>
        <span class="c1"># Name:</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&#34;name&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="c1"># verified status:</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&#34;verified&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">verified</span><span class="p">)</span>

        <span class="c1"># Tweet ID:</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&#34;id&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="c1"># Date:</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&#34;created_at&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">created_at</span><span class="p">)</span>
        <span class="c1"># Full text of tweet:</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&#34;full_text&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">full_text</span><span class="p">)</span>
        <span class="c1"># Get retweet count:</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_count&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">retweet_count</span><span class="p">)</span>
        <span class="c1"># Get favorite count:</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&#34;favorite_count&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">favorite_count</span><span class="p">)</span>
        
        <span class="c1"># Get hashtags:</span>
        <span class="n">hashtags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">hashtag</span> <span class="ow">in</span> <span class="n">tweet</span><span class="o">.</span><span class="n">entities</span><span class="p">[</span><span class="s2">&#34;hashtags&#34;</span><span class="p">]:</span>
                <span class="n">hashtags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hashtag</span><span class="p">[</span><span class="s2">&#34;text&#34;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hashtags</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;hashtags&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;hashtags&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hashtags</span><span class="p">)</span>

        <span class="c1"># Get user mentions:</span>
        <span class="n">mentions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">mention</span> <span class="ow">in</span> <span class="n">tweet</span><span class="o">.</span><span class="n">entities</span><span class="p">[</span><span class="s2">&#34;user_mentions&#34;</span><span class="p">]:</span>
                <span class="n">mentions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mention</span><span class="p">[</span><span class="s2">&#34;screen_name&#34;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mentions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;user_mentions&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;user_mentions&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mentions</span><span class="p">)</span>

        <span class="c1"># In reply to user id:</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&#34;in_reply_to_user_id&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">in_reply_to_user_id</span><span class="p">)</span>
        <span class="c1"># In reply to user screen name:</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&#34;in_reply_to_screen_name&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">in_reply_to_screen_name</span><span class="p">)</span>
        <span class="c1"># Check if quote status:</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&#34;is_quote_status&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">is_quote_status</span><span class="p">)</span>

        <span class="c1"># Check retweeted status:</span>
        <span class="k">if</span> <span class="s2">&#34;retweeted_status&#34;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="o">.</span><span class="n">_json</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># Then it is a retweet:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;is_retweet&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># Get OG tweet id:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_og_id&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">retweeted_status</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="c1"># Get OG author ID:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_og_author_id&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">retweeted_status</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="c1"># Get OG author screen name:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_og_author_screen_name&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">retweeted_status</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">screen_name</span><span class="p">)</span>
            <span class="c1"># Get OG author name:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_og_author_name&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">retweeted_status</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="c1"># Get date of OG tweet:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_og_date&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">retweeted_status</span><span class="o">.</span><span class="n">created_at</span><span class="p">)</span>
            <span class="c1"># Get OG full text:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_og_full_text&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">retweeted_status</span><span class="o">.</span><span class="n">full_text</span><span class="p">)</span>
            <span class="c1"># Get OG retweet count:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_og_retweet_count&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">retweeted_status</span><span class="o">.</span><span class="n">retweet_count</span><span class="p">)</span>
            <span class="c1"># Get OG favorite count:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_og_favorite_count&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">retweeted_status</span><span class="o">.</span><span class="n">favorite_count</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;is_retweet&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_og_id&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_og_author_id&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_og_author_screen_name&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_og_author_name&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_og_date&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_og_full_text&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_og_retweet_count&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&#34;retweet_og_favorite_count&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="c1"># Save to Pandas dataframe:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>


<span class="c1"># Call the function and save results:</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">tweet_scraper</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="n">lang</span><span class="p">,</span> <span class="n">tweet_mode</span><span class="o">=</span><span class="n">tweet_mode</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">,</span> <span class="n">tweet_limit</span><span class="o">=</span><span class="n">tweet_limit</span><span class="p">)</span>

<span class="c1"># Save our results:</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s2">&#34;twitter_data&#34;</span><span class="o">.</span><span class="n">json</span><span class="s2">&#34;)</span>
</code></pre></div><p>That&rsquo;s it! A complete Twitter scraping program.</p>
<h2 id="conclusion">Conclusion</h2>
<p>This tutorial covered how to build custom Twitter datasets using the Tweepy package in Python and the Twitter API. We covered a lot of ground and dug in to some complex coding examples. This is just the tip of the iceberg: there is so much more to cover! I strongly recommend you <a class="link" href="https://docs.tweepy.org/en/stable/"  target="_blank" rel="noopener"
    >check out the official Tweepy documentation</a> to familiarize yourself the ins and outs of the package.</p>
<p>Also, make sure you spend time reading through the official <a class="link" href="https://developer.twitter.com/en/docs/twitter-api/v1"  target="_blank" rel="noopener"
    >Twitter API documentation</a> to learn all the nuances of Twitter&rsquo;s developer platform. Going directly to the source is usually the best course of action!</p>
<p>Future tutorial series will look at different ways to analyze Twitter data. For now, though, thank you for reading this tutorial. Feel free to reach out if you have any questions.</p>
<p>Happy coding!</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/socilabs/tags/python/">python</a>
        
            <a href="/socilabs/tags/advanced/">advanced</a>
        
    </section>


    </footer>


    
</article>

    <aside class="related-contents--wrapper">
    
    
        <h2 class="section-title">Related contents</h2>
        <div class="related-contents">
            <div class="flex article-list--tile">
                
                    
<article class="has-image">
    <a href="/socilabs/p/install-python/">
        
        
            <div class="article-image">
                <img src="/socilabs/p/install-python/python.d57d3ef7c12240d9300498f6be74d3a9_hu10dcf594c52feaf835a7b27535ee84db_6082746_250x150_fill_q75_box_smart1.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy" 
                        data-key="install-python" 
                        data-hash="md5-1X0&#43;98EiQNkwBJj2vnTTqQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Install Python &amp; Anaconda</h2>
        </div>
    </a>
</article>
                
            </div>
        </div>
    
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2021 SociLabs
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.2.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer="true"
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    
        <aside class="sidebar right-sidebar sticky">
            <section class="widget archives">
                <div class="widget-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



                </div>
                <h2 class="widget-title section-title">Table of contents</h2>
                
                <div class="widget--toc">
                    <nav id="TableOfContents">
  <ol>
    <li><a href="#introduction">Introduction</a>
      <ol>
        <li><a href="#prerequisites">Prerequisites</a></li>
      </ol>
    </li>
    <li><a href="#setting-up-the-environment">Setting up the Environment</a>
      <ol>
        <li><a href="#install-packages">Install Packages</a></li>
      </ol>
    </li>
    <li><a href="#setting-up-tweepy-with-your-credentials">Setting Up Tweepy With Your Credentials</a>
      <ol>
        <li><a href="#connect-to-the-twitter-api">Connect to the Twitter API</a></li>
      </ol>
    </li>
    <li><a href="#searching-twitter-for-data">Searching Twitter for Data</a>
      <ol>
        <li><a href="#the-search_tweets-method">The search_tweets Method</a></li>
        <li><a href="#navigating-json--dictionaries">Navigating JSON &amp; Dictionaries</a></li>
        <li><a href="#paginating-twitter-data">Paginating Twitter Data</a></li>
      </ol>
    </li>
    <li><a href="#a-working-example">A Working Example</a>
      <ol>
        <li><a href="#refactoring-into-a-function">Refactoring Into a Function</a></li>
      </ol>
    </li>
    <li><a href="#saving-the-data">Saving the Data</a>
      <ol>
        <li><a href="#saving-as-json">Saving as JSON</a></li>
        <li><a href="#saving-to-a-csv">Saving to a CSV</a></li>
      </ol>
    </li>
    <li><a href="#putting-it-all-together">Putting it All Together</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ol>
</nav>
                </div>
            </section>
        </aside>
    

        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                defer="false"
                >
            </script><script type="text/javascript" src="/socilabs/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
